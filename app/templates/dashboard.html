{% extends "base.html" %}
{% block title %}Calendar · Daily Manna{% endblock %}
{% block content %}
<section id="flash-messages" class="flash-messages">
  {% if message %}
    <div class="flash success" data-type="success">{{ message }}</div>
  {% endif %}
  {% if error %}
    <div class="flash error" data-type="error">{{ error }}</div>
  {% endif %}
</section>
<section class="summary">
  <p>Schedule file: <code>{{ schedule_path }}</code></p>
</section>
<section class="calendar-shell">
  <header class="calendar-toolbar">
    <div class="calendar-toolbar-info">
      <h2 id="month-year" class="calendar-range">Loading...</h2>
      <p class="calendar-help-text">Shift-click to multi-select, drag selections to move, or press <kbd>Shift</kbd>+<kbd>D</kbd> to jump to a specific date.</p>
      <div class="calendar-toolbar-batch" id="batch-toolbar" hidden>
        <button type="button" id="batch-edit-btn" class="primary">Edit All</button>
        <span id="selection-count"></span>
      </div>
    </div>
    <div class="calendar-toolbar-controls">
      <button type="button" id="prev-month" aria-label="Previous month">‹</button>
      <button type="button" id="today-month">Today</button>
      <button type="button" id="next-month" aria-label="Next month">›</button>
    </div>
  </header>
  <div id="calendar-scroll" class="calendar-scroll" aria-live="polite"></div>
</section>
<div id="calendar-popover" class="calendar-popover" hidden role="dialog" aria-modal="true" aria-labelledby="popover-date-label">
  <form id="popover-form">
    <header class="popover-header">
      <div>
        <p class="popover-date" id="popover-date-label"></p>
        <p class="popover-meta" id="popover-sent-meta"></p>
      </div>
      <button type="button" class="popover-close" data-action="close" aria-label="Close popover">×</button>
    </header>
    <input type="hidden" name="date" id="popover-date" value="">
    <div class="popover-field">
      <label for="popover-selector">Selector</label>
      <input type="text" id="popover-selector" name="selector" placeholder="e.g. 2-1-3" required>
    </div>
    <div class="popover-field">
      <label for="popover-status">Status</label>
      <select id="popover-status" name="status">
        <option value="">-- Select status --</option>
        <option value="pending">Pending</option>
        <option value="sent">Sent</option>
        <option value="skipped">Skipped</option>
      </select>
    </div>
    <div class="popover-field">
      <label for="popover-notes">Notes</label>
      <textarea id="popover-notes" name="notes" rows="3" placeholder="Add context"></textarea>
    </div>
    <div class="popover-field">
      <label for="popover-override">Override descriptor</label>
      <input type="text" id="popover-override" name="override" placeholder="Optional override">
    </div>
    <div class="popover-actions">
      <div class="popover-action-group">
        <button type="submit" class="primary">Save</button>
        <button type="button" data-action="mark-sent">Mark sent</button>
        <button type="button" data-action="mark-skipped">Mark skipped</button>
      </div>
      <button type="button" data-action="close">Cancel</button>
    </div>
  </form>
</div>
<div id="date-adjust-overlay" class="calendar-move-overlay" hidden>
  <form id="date-adjust-form" class="calendar-move-card">
    <p>Move selected events to:</p>
    <input type="date" id="date-adjust-input" required>
    <div class="overlay-actions">
      <button type="submit" class="primary">Apply</button>
      <button type="button" data-action="cancel">Cancel</button>
    </div>
  </form>
</div>
<div id="batch-edit-overlay" class="calendar-edit-overlay" hidden>
  <form id="batch-edit-form" class="calendar-edit-card">
    <p>Edit selected events:</p>
    <div class="batch-edit-field">
      <label for="batch-selector">Selector</label>
      <input type="text" id="batch-selector" name="selector" placeholder="e.g. 2-1-3">
      <small>Leave blank to keep existing values</small>
    </div>
    <div class="batch-edit-field">
      <label for="batch-status">Status</label>
      <select id="batch-status" name="status">
        <option value="">-- Keep existing --</option>
        <option value="pending">Pending</option>
        <option value="sent">Sent</option>
        <option value="skipped">Skipped</option>
      </select>
    </div>
    <div class="batch-edit-field">
      <label for="batch-notes">Notes</label>
      <textarea id="batch-notes" name="notes" rows="3" placeholder="Add context"></textarea>
      <small>Leave blank to keep existing values</small>
    </div>
    <div class="batch-edit-field">
      <label for="batch-override">Override descriptor</label>
      <input type="text" id="batch-override" name="override" placeholder="Optional override">
      <small>Leave blank to keep existing values</small>
    </div>
    <div class="overlay-actions">
      <button type="submit" class="primary">Apply to All</button>
      <button type="button" data-action="cancel">Cancel</button>
    </div>
  </form>
</div>
<script>
  window.CalendarConfig = {
    schedulePath: "{{ schedule_path }}",
    message: null,
    error: null
  };
</script>
<script src="/static/calendar.js" defer></script>
{% endblock %}
